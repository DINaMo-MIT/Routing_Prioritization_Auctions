from helpers import *   ## Constants are over here
from agents import *
from grid import *
from grid_cap import *
import pickle
# from envs import *
# from simulate import *


radius = 7

# locations = {270: Hex(2,4,-6), 299: Hex(-6,4,2), 108: Hex(3,0,-3), 29: Hex(1,4,-5), 71: Hex(-4,2,2), 152: Hex(0,-4,4), 418: Hex(-4,1,3), 17: Hex(2,2,-4), 40: Hex(-3,4,-1), 132: Hex(-2,-1,3), 191: Hex(-2,1,1), 50: Hex(2,2,-4), 121: Hex(-2,-2,4), 145: Hex(1,1,-2), 163: Hex(1,4,-5), 428: Hex(3,-5,2), 441: Hex(1,2,-3), 91: Hex(1,0,-1), 140: Hex(-1,1,0), 246: Hex(-3,4,-1), 316: Hex(-3,1,2), 350: Hex(0,-2,2), 434: Hex(1,6,-7), 2: Hex(-1,3,-2), 5: Hex(0,1,-1), 41: Hex(-1,3,-2), 128: Hex(-1,-1,2), 177: Hex(-1,0,1), 185: Hex(-1,1,0), 259: Hex(0,2,-2), 357: Hex(0,0,0), 444: Hex(-2,0,2), 58: Hex(-2,2,0), 70: Hex(-3,5,-2), 102: Hex(2,0,-2), 170: Hex(-4,1,3), 346: Hex(3,-1,-2), 24: Hex(-2,-2,4), 154: Hex(-2,-1,3), 223: Hex(-1,2,-1), 276: Hex(-3,3,0), 330: Hex(-2,-4,6), 337: Hex(5,0,-5), 400: Hex(3,-2,-1), 451: Hex(3,0,-3), 9: Hex(1,3,-4), 23: Hex(4,-1,-3), 76: Hex(2,1,-3), 77: Hex(4,-1,-3), 107: Hex(0,0,0), 138: Hex(3,-4,1), 210: Hex(0,-3,3), 229: Hex(-5,2,3), 300: Hex(4,-3,-1), 382: Hex(-3,3,0), 392: Hex(3,-1,-2), 433: Hex(-1,-2,3), 46: Hex(0,5,-5), 59: Hex(4,1,-5), 110: Hex(-3,-2,5), 137: Hex(1,-1,0), 149: Hex(-3,-1,4), 157: Hex(2,4,-6), 206: Hex(0,5,-5), 226: Hex(-3,6,-3), 232: Hex(-2,2,0), 333: Hex(-2,3,-1), 355: Hex(-5,5,0), 361: Hex(-5,4,1), 368: Hex(0,-4,4), 429: Hex(-1,-4,5), 36: Hex(1,-3,2), 97: Hex(-4,-1,5), 155: Hex(-3,6,-3), 156: Hex(7,-1,-6), 230: Hex(-5,4,1), 260: -1, 294: Hex(-1,5,-4), 298: -1, 311: Hex(-6,1,5), 349: -1, 364: Hex(-4,0,4), 371: Hex(4,3,-7), 415: Hex(-7,3,4), 165: -1, 187: -1, 212: -1, 322: -1, 324: -1}
# bids = {270: (Hex(2,5,-7), 5), 299: (Hex(-7,5,2), 3), 108: (Hex(3,1,-4), 2), 29: (Hex(2,4,-6), 1), 71: (Hex(-5,3,2), 8), 152: (Hex(1,-5,4), 1), 418: (Hex(-5,2,3), 1), 17: (Hex(1,3,-4), 7), 40: (Hex(-3,5,-2), 7), 132: (Hex(-2,-2,4), 7), 191: (Hex(-3,2,1), 4), 50: (Hex(3,1,-4), 5), 121: (Hex(-1,-2,3), 5), 145: (Hex(2,0,-2), 6), 163: (Hex(0,5,-5), 3), 428: (Hex(2,-5,3), 5), 441: (Hex(1,3,-4), 7), 91: (Hex(0,0,0), 6), 140: (Hex(-2,2,0), 3), 246: (Hex(-4,4,0), 4), 316: (Hex(-4,2,2), 7), 350: (Hex(1,-2,1), 4), 434: (Hex(0,7,-7), 6), 2: (Hex(-2,3,-1), 3), 5: (Hex(-1,1,0), 5), 41: (Hex(-2,3,-1), 7), 128: (Hex(0,-1,1), 8), 177: (Hex(0,0,0), 9), 185: (Hex(0,0,0), 3), 259: (Hex(-1,2,-1), 3), 357: (Hex(1,-1,0), 8), 444: (Hex(-2,1,1), 6), 58: (Hex(-1,2,-1), 3), 70: (Hex(-2,5,-3), 3), 102: (Hex(1,0,-1), 4), 170: (Hex(-4,2,2), 3), 346: (Hex(2,-1,-1), 3), 24: (Hex(-2,-1,3), 6), 154: (Hex(-1,-1,2), 9), 223: (Hex(-1,3,-2), 9), 276: (Hex(-2,3,-1), 5), 330: (Hex(-1,-4,5), 8), 337: (Hex(5,-1,-4), 3), 400: (Hex(2,-1,-1), 7), 451: (Hex(2,1,-3), 5), 9: (Hex(1,2,-3), 2), 23: (Hex(3,0,-3), 7), 76: (Hex(1,1,-2), 8), 77: (Hex(4,-2,-2), 5), 107: (Hex(-1,1,0), 8), 138: (Hex(2,-4,2), 1), 210: (Hex(0,-2,2), 3), 229: (Hex(-4,1,3), 5), 300: (Hex(3,-2,-1), 9), 382: (Hex(-2,2,0), 1), 392: (Hex(2,0,-2), 4), 433: (Hex(-1,-1,2), 2), 46: (Hex(1,4,-5), 5), 59: (Hex(4,2,-6), 2), 110: (Hex(-4,-1,5), 3), 137: (Hex(0,0,0), 9), 149: (Hex(-2,-2,4), 7), 157: (Hex(2,3,-5), 9), 206: (Hex(1,4,-5), 7), 226: (Hex(-2,5,-3), 5), 232: (Hex(-1,2,-1), 2), 333: (Hex(-1,2,-1), 6), 355: (Hex(-4,5,-1), 4), 361: (Hex(-4,3,1), 4), 368: (Hex(0,-3,3), 8), 429: (Hex(-1,-3,4), 5), 36: (Hex(0,-3,3), 9), 97: (Hex(-3,-1,4), 8), 155: (Hex(-3,5,-2), 1), 156: (Hex(6,-1,-5), 6), 230: (Hex(-4,3,1), 2), 260: (Hex(0,0,0), 9), 294: (Hex(-2,5,-3), 3), 298: (Hex(4,-1,-3), 1), 311: (Hex(-6,2,4), 1), 349: (Hex(3,-1,-2), 9), 364: (Hex(-3,0,3), 5), 371: (Hex(4,2,-6), 4), 415: (Hex(-6,3,3), 8), 165: (Hex(-4,-3,7), 8), 187: (Hex(1,4,-5), 5), 212: (Hex(-1,6,-5), 3), 322: (Hex(4,-1,-3), 1), 324: (Hex(0,-7,7), 8)}


# # get bids and locations
# bids = {}
# locs = {}
# for ag in active:
#     next_loc, price, _id = ag.bid
#     bids[_id] = (next_loc, price)
#     # bids.append(ag.bid)
#     locs[_id] = ag.loc

inbound = pickle.load(open('./prod_version/t27_complex_failure_102.pkl', 'rb'))
bids = inbound['bids']
locations = inbound['locations']
active = inbound['active']
layout = inbound['layout']

grid = GridCapacity(radius)
grid.set_priority("backpressure")
commands = grid.step_sim(locations, bids)